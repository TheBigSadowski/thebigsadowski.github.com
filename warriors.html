<!DOCTYPE html>
<html>

<head>
<title>Next Warriors Game</title>
<style>
body { font-family: helvetica, arial, sans-serif; font-size: 0.9em; max-width: 50em; margin: 0 auto; background: #1D428A; color: #FFC72C;   text-shadow:
    1px 1px 1px #fff,
    -1px 1px 1px #fff,
    1px -1px 1px #fff,
    -1px -1px 1px #fff; font-size: 5em;
}
h2 { margin-top: 30px; }
h4 { margin-bottom: 0; }
li { margin-top: 8px; margin-bottom: 8px; }
</style>
</head>

<body>

<section id="next"></section>

<section id="content"></section>

<script>
  function timeOfGame(game){
    return new Date(`${game['gdtutc']}T${game['utctm']}Z`);
  }
  function timeBetween(date1, date2) {
    const diff = Math.abs(date1 - date2);
    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor(diff / (1000*60*60)) % 24;
    const minutes = Math.floor(diff / (1000*60)) % 60;
    const seconds = Math.floor(diff / (1000)) % 60;
    var results = [];
    if (days > 0) {
      results.push(`${days} ${days == 1 ? 'day' : 'days'}`);
    }
    if (days > 0 || hours > 0) {
      results.push(`${hours} ${hours == 1 ? 'hour' : 'hours'}`);
    }
    if (days > 0 || hours > 0 || minutes > 0) {
      results.push(`${minutes} ${minutes == 1 ? 'minute' : 'minutes'}`);
    }
    if (days > 0 || hours > 0 || minutes > 0 || seconds > 0) {
      results.push(`${seconds} ${seconds == 1 ? 'second' : 'seconds'}`);
    }
    return results.join(', ');
  }
  async function getContent() {
    const response = await fetch("https://data.nba.com/data/10s/v2015/json/mobile_teams/nba/2023/league/00_full_schedule.json");
    const json = await response.json();
    const games = json['lscd'].map(month => month['mscd']['g']).flat().sort((a, b) => timeOfGame(a) - timeOfGame(b));
    const warriorsGames = games.filter(g => g['h']['ta'] === 'GSW' || g['v']['ta'] === 'GSW');
    const futureWarriorsGames = warriorsGames.filter(g => timeOfGame(g) > new Date());
    const content = futureWarriorsGames.map(g => `
      <h2>${g['v']['tn']} @ ${g['h']['tn']}</h2>
      <p>${timeOfGame(g)}</p>
    `);
    document.getElementById('content').innerHTML = '<h1>Next Games</h1>' + content.join('\n');


    document.nextGame = futureWarriorsGames[0];
    const updateNextGame = function(){
      const nextGame = document.nextGame;
      const today = new Date().toLocaleDateString();
      var tomorrow = new Date(new Date().setDate(new Date().getDate() + 1)).toLocaleDateString();
      const gameDate = new Date(timeOfGame(nextGame)).toLocaleDateString();
      var dayString = '<error>';
      if (gameDate === today) {
        dayString = 'Today';
      } else if (gameDate === tomorrow) {
        dayString = 'Tomorrow';
      } else {
        dayString = new Date(timeOfGame(nextGame)).toLocaleString('en-us', {  weekday: 'long' })
      }
      document.getElementById('next').innerHTML = `
        <h2>${nextGame['v']['tn']} @ ${nextGame['h']['tn']}</h2>
        <p>In ${timeBetween(timeOfGame(nextGame), new Date)}</p>
        <p> ${dayString} ${new Date(timeOfGame(nextGame)).toLocaleTimeString()}</p>
      `;
    };
    setInterval(updateNextGame, 1000);
    updateNextGame();
  }
  getContent()
</script>

<!-- curl https://data.nba.com/data/10s/v2015/json/mobile_teams/nba/2023/league/00_full_schedule.json | jq '.lscd[] | .mscd.g[] | select(.h.ta=="GSW" or .v.ta=="GSW") | {date: .gdte, home: {team: .h.ta, score: .h.s}, visitor: {team: .v.ta, score: .v.s}}' -->

</body>